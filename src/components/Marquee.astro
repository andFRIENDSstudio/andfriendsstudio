---
import projectsData from '../data/projects.json';
const projects = projectsData.projects || [];

// Helper to extract year from date string
const getYear = (dateString) => {
    if (!dateString) return '2024';
    return new Date(dateString).getFullYear().toString();
};

// Helper to determine card size based on aspect ratio or manual override
const getCardSize = (project) => {
    // If manually set, use that
    if (project.displaySize && ['narrow', 'standard', 'wide', 'extra-wide'].includes(project.displaySize)) {
        return project.displaySize;
    }
    
    // Default to standard if not set
    return 'standard';
};

// Smart grouping to create visual rhythm
const organizeProjects = (projects) => {
    // For now, return as-is
    // We can add shuffle/rhythm logic later
    return projects;
};

const organizedProjects = organizeProjects(projects);
---

<div class="marquee-wrapper">
    <div class="marquee-track">
        {organizedProjects.map((project) => {
            const size = getCardSize(project);
            return (
                <div 
                    class={`grey-box size-${size}`}
                    data-project={project.title}
                    data-contributors={project.contributors?.join(', ')}
                    data-year={getYear(project.date)}
                    style={`background-image: url(${project.image}); background-size: cover; background-position: center;`}
                >
                </div>
            );
        })}
    </div>
</div>

<style>
    .grey-box {
        height: 100%;
        flex-shrink: 0;
    }
    
    /* Fluid width sizes based on aspect ratios
       Height is clamp(35vh, 3vw + 45vh, 65vh) - roughly 50vh on average
       So we calculate widths relative to that */
    .grey-box.size-narrow {
        width: 28vh; /* 9:16 portrait (50vh × 9/16 = 28vh) */
        min-width: 200px;
    }
    
    .grey-box.size-standard {
        width: 50vh; /* 1:1 square (50vh × 1 = 50vh) */
        min-width: 350px;
    }
    
    .grey-box.size-wide {
        width: 89vh; /* 16:9 widescreen (50vh × 16/9 = 89vh) */
        min-width: 620px;
    }
    
    .grey-box.size-extra-wide {
        width: 100vh; /* 2:1 cinemascope (50vh × 2 = 100vh) */
        min-width: 700px;
    }
</style>